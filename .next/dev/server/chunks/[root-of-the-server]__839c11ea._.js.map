{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/chiio/VSCode/wedd-inv/app/api/admin/reset-password/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    const email = (body?.email || \"\").toString().trim()\n\n    if (!email) {\n      return NextResponse.json({ success: false, error: \"Email diperlukan\" }, { status: 400 })\n    }\n\n    const cookieStore = await cookies()\n\n    const supabase = createServerClient(process.env.SUPABASE_URL!, process.env.SUPABASE_ANON_KEY!, {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n          } catch {\n            // ignore\n          }\n        },\n      },\n    })\n\n    // Build a redirectTo URL for the reset link.\n    // Priority: explicit `NEXT_PUBLIC_SITE_URL` env var -> Vercel runtime `VERCEL_URL` -> derive from request headers -> undefined\n    let redirectTo: string | undefined = undefined\n\n    const normalize = (u: string) => u.replace(/\\/$/, \"\")\n\n    if (process.env.NEXT_PUBLIC_SITE_URL) {\n      redirectTo = `${normalize(process.env.NEXT_PUBLIC_SITE_URL)}/admin/reset-password`\n    } else if (process.env.VERCEL_URL) {\n      // VERCEL_URL is provided in Vercel production runtime (e.g. \"my-app-abc.vercel.app\")\n      // assume https for Vercel deployments\n      redirectTo = `https://${normalize(process.env.VERCEL_URL)}/admin/reset-password`\n    } else {\n      // Try to derive origin from request headers (x-forwarded-proto and host) which may be present on Vercel or proxies.\n      const proto = (request.headers.get(\"x-forwarded-proto\") || request.headers.get(\"x-forwarded-protocol\") || \"https\").split(\",\")[0]\n      const host = request.headers.get(\"x-forwarded-host\") || request.headers.get(\"host\")\n      if (host) {\n        redirectTo = `${proto}://${normalize(host)}/admin/reset-password`\n      }\n    }\n\n    // Send password reset email\n    const { error } = await supabase.auth.resetPasswordForEmail(email, redirectTo ? { redirectTo } : undefined)\n\n    if (error) {\n      return NextResponse.json({ success: false, error: error.message }, { status: 400 })\n    }\n\n    // If caller requested debug, include the redirectTo used so we can verify the URL.\n    const bodyOut: any = { success: true }\n    try {\n      // request.json() was already consumed earlier; use the parsed `body` variable\n      const reqBody = body as any\n      if (reqBody?.debug) {\n        bodyOut.redirectTo = redirectTo ?? null\n      }\n    } catch {\n      // ignore\n    }\n\n    return NextResponse.json(bodyOut)\n  } catch (err: any) {\n    return NextResponse.json({ success: false, error: err?.message || String(err) }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,QAAQ,CAAC,MAAM,SAAS,EAAE,EAAE,QAAQ,GAAG,IAAI;QAEjD,IAAI,CAAC,OAAO;YACV,OAAO,wSAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxF;QAEA,MAAM,cAAc,MAAM,IAAA,oSAAO;QAEjC,MAAM,WAAW,IAAA,uUAAkB,EAAC,QAAQ,GAAG,CAAC,YAAY,EAAG,QAAQ,GAAG,CAAC,iBAAiB,EAAG;YAC7F,SAAS;gBACP;oBACE,OAAO,YAAY,MAAM;gBAC3B;gBACA,QAAO,YAAY;oBACjB,IAAI;wBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;oBAClF,EAAE,OAAM;oBACN,SAAS;oBACX;gBACF;YACF;QACF;QAEA,6CAA6C;QAC7C,+HAA+H;QAC/H,IAAI,aAAiC;QAErC,MAAM,YAAY,CAAC,IAAc,EAAE,OAAO,CAAC,OAAO;QAElD,wCAAsC;YACpC,aAAa,GAAG,qEAA4C,qBAAqB,CAAC;QACpF;;QAaA,4BAA4B;QAC5B,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,qBAAqB,CAAC,OAAO,aAAa;YAAE;QAAW,IAAI;QAEjG,IAAI,OAAO;YACT,OAAO,wSAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,mFAAmF;QACnF,MAAM,UAAe;YAAE,SAAS;QAAK;QACrC,IAAI;YACF,8EAA8E;YAC9E,MAAM,UAAU;YAChB,IAAI,SAAS,OAAO;gBAClB,QAAQ,UAAU,GAAG,cAAc;YACrC;QACF,EAAE,OAAM;QACN,SAAS;QACX;QAEA,OAAO,wSAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,KAAU;QACjB,OAAO,wSAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,KAAK,WAAW,OAAO;QAAK,GAAG;YAAE,QAAQ;QAAI;IACjG;AACF"}}]
}